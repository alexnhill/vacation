<h1>New Item Page</h1>
<div id="locationField">
  <input id="autocomplete" placeholder="Add a New Place" onFocus="geolocate()" type="text"></input>
</div>

<section>
  <%= form_for [@trip, @item] do |i| %>
  <div>
    <h3><%= i.label :title %></h3>
    <p><%= i.text_field :title %></p>
  </div>
  <div>
    <h3><%= i.label :category %></h3>
    <p><%= i.select :category, [['Location', 'location'], ['Event','event'], ['Other','other']] %></p>
  </div>
  <div>
    <h3><%= i.label :lookup %></h3>
    <p><%= i.text_field :lookup %></p>
  </div>
  <div>
    <p><%= i.label :address %></p>
    <p><%= i.text_field :address %></p>
  </div>
  <div>
    <p><%= i.label :image %></p>
    <p><%= url_field(:item, :image) %></p>
  </div>
  <div>
    <p><%= i.label :date %></p>
    <%= date_field(:item, :date) %>
  </div>
  <div>
    <p><%= i.label :body %></p>
    <p><%= i.text_field :body %></p>
  </div>
  <div>
    <%= i.submit %>
  </div>
  <% end %>
</section>

<script>
  var placeSearch, autocomplete;

  function initAutocomplete() {
    // Create the autocomplete object, restricting the search to geographical
    // location types.
    autocomplete = new google.maps.places.Autocomplete(
      (document.getElementById('autocomplete'))
      );
    // When the user selects an address from the dropdown, populate the address fields in the form.
    autocomplete.addListener('place_changed', fillInAddress);
  }

  function fillInAddress() {
    // Get the place details from the autocomplete object.
    var place = autocomplete.getPlace();

    var lookupID = place.place_id;
    var imageURL = place.photos[0].getUrl({'maxWidth': 800, 'maxHeight': 500})
    var address = place.formatted_address
    var title = place.name

    document.getElementById('item_lookup').value = lookupID;
    document.getElementById('item_image').value = imageURL;
    document.getElementById('item_address').value = address;
    document.getElementById('item_title').value = title;
  }

  function geolocate() {
    // Bias the autocomplete object to the user's geographical location,
    // as supplied by the browser's 'navigator.geolocation' object.
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var geolocation = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
        var circle = new google.maps.Circle({
          center: geolocation,
          radius: position.coords.accuracy
        });
        autocomplete.setBounds(circle.getBounds());
      });
    }
  }

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBmWYK4EZmBmDeiEhduAajCiTiAqrt8BGc&libraries=places&callback=initAutocomplete" async defer></script>
